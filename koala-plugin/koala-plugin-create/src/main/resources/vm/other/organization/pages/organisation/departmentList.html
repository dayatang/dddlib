<style>
    .department-detail .row > .form-group{
        margin-left: 0;
        margin-right: 0;
        border: 1px solid #DDDDDD;
    }
    .department-detail .control-label {
        text-align: right;
    }
    .department-detail .base-info {
        border-width: 1px 0 0 1px;
        border-collapse: separate;
        margin-bottom: 10px;
    }
    .department-detail .grid-table-body{
        height: 210px;
    }
     .base-info {
     	border-collapse: separate;
     }
    .base-info td {
    	border-width: 0 1px 1px 0!important;
    	border-color: transparent #DDDDDD #DDDDDD transparent!important;
    	border-style: solid
    }
    .department-detail .buttons {
     	margin-top: 28%;
    }
</style>
<div class="department-detail" id="departmentDetail">
    <ul class="u-tree tree" id="departmentTree"  oncontextmenu="return false"></ul>
    <div class="right-content">
        <table class="table table-bordered table-hover base-info">
            <tr>
                <td>
                    <label class="col-lg-5 control-label">编号:</label>
                    <div class="col-lg-7">
                        <span data-role="number"></span>
                        <input type="hidden" data-role="id">
                        <input type="hidden" data-role="organizationType">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <label class="col-lg-5 control-label">名称:</label>
                    <div class="col-lg-7">
                        <span data-role="name"></span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <label class="col-lg-5 control-label">机构负责人:</label>
                    <div class="col-lg-7">
                        <span data-role="principalName"></span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <label class="col-lg-5 control-label">描述:</label>
                    <div class="col-lg-7">
                        <span data-role="description"></span>
                    </div>
                </td>
            </tr>
        </table>
       
        <div class="btn-group buttons pull-right">
            <button id="addCompany"type="button" class="btn btn-primary" ><span class="glyphicon glyphicon-plus"></span>&nbsp;创建分公司</button>
            <button id="addDepartment"type="button" class="btn btn-primary" ><span class="glyphicon glyphicon-plus"></span>&nbsp;创建下级部门</button>
            <button id="employeeListBtn" class="btn btn-info" type="button"><span class="glyphicon glyphicon-user"></span>&nbsp;员工列表</button>   
            <button id="updateDepartment" type="button" class="btn btn-success"><span class="glyphicon glyphicon-wrench"></span>&nbsp;修改</button>
            <button id="updateCompany" type="button" class="btn btn-success"><span class="glyphicon glyphicon-wrench"></span>&nbsp;修改</button>
            <button id="delete" class="btn btn-danger" type="button"><span class="glyphicon glyphicon-remove"></span>&nbsp;撤销</button>
        </div>
    </div>
    <div style="clear:both;"></div>
</div>
<script>
    $(function(){
        var script = document.createElement('script');
        script.src = contextPath + '/js/organisation/department.js';
        script.onreadystatechange= function () {
            if (this.readyState == 'complete' || this.readyState == 'loaded'){
                department().getTree();
            }
        }
        script.onload= function(){
            department().getTree();
        }
        document.getElementById('departmentDetail').parentNode.appendChild(script);
        script = document.createElement('script');
        script.src = contextPath + '/js/organisation/selectEmployee.js';
        document.getElementById('departmentDetail').parentNode.appendChild(script);
        $('#employeeListBtn').on('click', function(){
            department().showEmployeeList($('.right-content').find('[data-role="id"]').val(), $('#department-employee-list'));
        })
       $('#addDepartment').on('click', function(){
           department().addDepartment($('.right-content').find('[data-role="id"]').val(),
                   $('.right-content').find('[data-role="organizationType"]').val());
        })
        $('#addCompany').on('click', function(){
            department().addCompany($('.right-content').find('[data-role="id"]').val());
        })
        $('#updateDepartment').on('click', function(){
            department().updateDepartment($('.right-content').find('[data-role="id"]').val())
        })
        $('#updateCompany').on('click', function(){
            department().updateCompany($('.right-content').find('[data-role="id"]').val())
        })
       $('#delete').on('click', function(){
            $(this).confirm({
                content: '确定要撤销该机构吗?',
                callBack: function(){
                	var id = $('.right-content').find('[data-role="id"]').val();
                	$.get( contextPath + '/organization/getOrg.koala?id='+id).done(function(data){
            			var org = data.org;
                        var type = org.organizationType;
            			delete org.children;
                        delete org.organizationType;
                        department().del(org, type);
                	})
                }
            })
        })
    })
</script>